<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload & Display</title>
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject, listAll } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBMS_SwjUwlrNGbbdLNQvxfqJKy1whqH-Y",
          authDomain: "file-4f9fe.firebaseapp.com",
          projectId: "file-4f9fe",
          storageBucket: "file-4f9fe.appspot.com",
          messagingSenderId: "777922174298",
          appId: "1:777922174298:web:70b8c6a5006512ef4ce763",
          measurementId: "G-VE72B5E88S"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Function to upload files
        window.uploadFile = async function () {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) {
                alert("Please select a file to upload!");
                return;
            }

            const file = fileInput.files[0];
            const storageRef = ref(storage, `uploads/${file.name}`);

            try {
                await uploadBytes(storageRef, file);
                alert('File uploaded successfully!');
                displayFiles();
            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed!');
            }
        };

        // Function to display uploaded files
       // Function to display uploaded files
window.displayFiles = async function () {
    const fileList = document.getElementById('fileList');
    fileList.innerHTML = '';

    const storageRef = ref(storage, 'uploads'); // Ensure correct reference

    try {
        const result = await listAll(storageRef);
        
        if (result.items.length === 0) {
            fileList.innerHTML = "<p>No files found.</p>";
        }

        result.items.forEach(async (fileRef) => {
            const url = await getDownloadURL(fileRef);

            const fileDiv = document.createElement('div');
            fileDiv.innerHTML = `
            <p>${fileRef.name}</p>
            <button onclick="openFile('${url}')">Download</button>
            <button onclick="deleteFile('${fileRef.fullPath}')">Delete</button>
        `;
        
            fileList.appendChild(fileDiv);
        });

    } catch (error) {
        console.error('Error fetching file list:', error);
        alert('Error fetching file list! Check Firebase rules.');
    }
};


        // Function to download files and show in browser's "Downloads" folder
// Function to download files directly from Firebase Storage
// Function to force file download instead of opening in a new tab
window.openFile = function (fileUrl) {
    window.open(fileUrl, "_blank"); // Opens the file in a new browser tab
};




        // Function to delete files
        window.deleteFile = async function (filePath) {
            const fileRef = ref(storage, filePath);

            try {
                await deleteObject(fileRef);
                alert('File deleted successfully!');
                displayFiles();
            } catch (error) {
                console.error('Error deleting file:', error);
                alert('Error deleting file!');
            }
        };

        // Load files on page load
        window.onload = displayFiles;
    </script>
</head>
<body>
    <div class="container">
        <h1>Upload & Manage Files</h1>
        <input type="file" id="fileInput">
        <button onclick="uploadFile()">Upload</button>
        <div id="fileList"></div>
    </div>
</body>
</html>
